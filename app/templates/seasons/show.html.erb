<h1><%= season.title %></h1>
<% count = -1 %>

<%= form_for :registration, routes.path(:create_registrations, slug: season.slug) do |f| %>
  <div>
    <%= f.label "Votre adresse courriel", for: :email %>
    <%= f.email_field :email, placeholder: "moi@hotmail.com", required: true %>
  </div>

  <% f.fields_for :events do |f0| %>
    <% events.each do |event| %>
      <h2><%= event.title %></h2>

      <% Array(registrations[event.id]).each do |registration| %>
        <div>occupé</div>
      <% end %>

      <% (event.max_registrations - (registrations[event.id] || []).size).times do %>
        <% count += 1 %>
        <% f0.fields_for(count) do |f1| %>
          <div>
            <%= f1.hidden_field :event_id, value: event.slug %>
            <%= f1.label "Prénom et nom", for: :name %>
            <%= f1.text_field :name, placeholder: "John Doe" %>
            <%= f1.label "Rôle", for: :role %>
            <%= f1.text_field :role, placeholder: "Unité ou rôle" %>
          </div>
        <% end %>
      <% end %>
    <% end %>
    </div>
  <% end %>

  <%= f.button "Enregistrer" %>
<% end %>
