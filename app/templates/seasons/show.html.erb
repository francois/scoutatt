<h1><%= season.title %></h1>
<% count = -1 %>

<%= form_for :registration, routes.path(:create_registrations, slug: season.slug) do |f| %>
  <div>
    <%= f.label "Votre adresse courriel", for: :email %>
    <%= f.email_field :email, placeholder: "moi@hotmail.com", required: true %>
  </div>

  <% events.each do |event| %>
    <h2><%= event.title %></h2>

    <% registrations[event.id].each do |registration| %>
      <div>occupé</div>
    <% end %>

    <% (event.max_registrations - (registrations[event.id] || []).size).times do %>
      <% count += 1 %>
      <% f.fields_for(count) do |g| %>
        <div>
          <%= g.hidden_field :event, value: event.slug %>
          <%= g.label "Prénom et nom", for: :name %>
          <%= g.text_field :name, placeholder: "John Doe" %>
          <%= g.label "Rôle", for: :role %>
          <%= g.text_field :role, placeholder: "Unité ou rôle" %>
        </div>
      <% end %>
    <% end %>
    </div>
  <% end %>

  <%= f.button "Enregistrer" %>
<% end %>
